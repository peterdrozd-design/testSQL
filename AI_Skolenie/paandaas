import pandas as pd
import pandasai as pai
from pandasai import Agent
from pandasai_litellm.litellm import LiteLLM
import os
import warnings

# Suppress Pydantic serialization warnings
warnings.filterwarnings("ignore", category=UserWarning, module="pydantic.main")

# Configure PandasAI globally to use LiteLLM with OpenAI
# llm = LiteLLM(model="gpt-3.5-turbo", api_key=os.getenv("OPENAI_API_KEY"))
llm = LiteLLM(model="openrouter/mistralai/devstral-2512:free", api_key=os.getenv("OPENROUTER_API_KEY"))
pai.config.set({"llm": llm})

df = pd.DataFrame(
    {
        "employee": ["Alice", "Bob", "Charlie", "Diana"],
        "department": ["Sales", "IT", "Sales", "HR"],
        "salary": [75000, 85000, 70000, 65000],
    }
)


agent = Agent(df)
response = agent.chat("What is the average salary by department?")
print(response)